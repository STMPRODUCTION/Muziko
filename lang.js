   // Translation data
    const translations = {
      'en': {
        'welcome-title': 'Welcome to Muziko',
        'tagline': 'Practice. Play. Progress.',
        'description-1': 'Muziko is one of the best ways to sharpen your sight-reading skills and grow as a musician.',
        'description-2': 'It connects seamlessly to any MIDI-enabled digital instrument—like a piano or MIDI guitar—and generates real musical scores in real time.',
        'description-3': 'Simply play the notes you see, and Muziko will provide instant feedback on your accuracy, helping you improve note by note.',
        'start-btn': 'Start Training',
        'terms': 'Terms of Service',
        'privacy': 'Privacy Policy',
        'legal': 'Legal',
        'title': "Muziko",
        'start_button': "Start Exercise",
        'status_message': 'Click "Start Exercise" to begin',
        'accuracy_label': "Accuracy:",
        'time_label': "Time:",
        'midi_connected': "MIDI device connected!",
        'no_midi_found': "No MIDI device found. Using virtual piano.",
        'midi_failed': "MIDI access failed. Using virtual piano.",
        'device_virtual': "Virtual Piano",
        'device_midi': "External MIDI Device",
        'accuracy_chart_title': 'Accuracy Over Exercises',
        'time_chart_title': 'Time Per Exercise',
        'accuracy_y_label': 'Accuracy %',
        'time_y_label': 'Seconds'
      },
      'es': {
        'welcome-title': 'Bienvenido a Muziko',
        'tagline': 'Practica. Toca. Progresa.',
        'description-1': 'Muziko es una de las mejores formas de mejorar tus habilidades de lectura a primera vista y crecer como músico.',
        'description-2': 'Se conecta perfectamente a cualquier instrumento digital habilitado para MIDI, como un piano o guitarra MIDI, y genera partituras musicales reales en tiempo real.',
        'description-3': 'Simplemente toca las notas que ves, y Muziko te proporcionará comentarios instantáneos sobre tu precisión, ayudándote a mejorar nota por nota.',
        'start-btn': 'Comenzar Entrenamiento',
        'terms': 'Términos de Servicio',
        'privacy': 'Política de Privacidad',
        'legal': 'Legal',
        'title': "Muziko",
        'start_button': "Iniciar Ejercicio",
        'status_message': 'Haz clic en "Iniciar Ejercicio" para comenzar',
        'accuracy_label': "Precisión:",
        'time_label': "Tiempo:",
        'midi_connected': "¡Dispositivo MIDI conectado!",
        'no_midi_found': "No se encontró ningún dispositivo MIDI. Usando piano virtual.",
        'midi_failed': "Fallo en el acceso MIDI. Usando piano virtual.",
        'device_virtual': "Piano virtual",
        'device_midi': "Dispositivo MIDI externo",
        'accuracy_chart_title': 'Precisión a lo largo de los ejercicios',
        'time_chart_title': 'Tiempo por ejercicio',
        'accuracy_y_label': 'Precisión %',
        'time_y_label': 'Segundos'
      },
      'fr': {
        'welcome-title': 'Bienvenue sur Muziko',
        'tagline': 'Pratiquez. Jouez. Progressez.',
        'description-1': 'Muziko est l\'un des meilleurs moyens d\'améliorer vos compétences de lecture à vue et de grandir en tant que musicien.',
        'description-2': 'Il se connecte parfaitement à tout instrument numérique compatible MIDI - comme un piano ou une guitare MIDI - et génère de vraies partitions musicales en temps réel.',
        'description-3': 'Jouez simplement les notes que vous voyez, et Muziko vous fournira des commentaires instantanés sur votre précision, vous aidant à vous améliorer note par note.',
        'start-btn': 'Commencer l\'Entraînement',
        'terms': 'Conditions de Service',
        'privacy': 'Politique de Confidentialité',
        'legal': 'Légal',
        'start_button': "Démarrer l'exercice",
        'status_message': 'Cliquez sur "Démarrer l\'exercice" pour commencer',
        'accuracy_label': "Précision :",
        'time_label': "Temps :",
        'midi_connected': "Appareil MIDI connecté !",
        'no_midi_found': "Aucun appareil MIDI trouvé. Utilisation du piano virtuel.",
        'midi_failed': "Échec de l'accès MIDI. Utilisation du piano virtuel.",
        'device_virtual': "Piano virtuel",
        'device_midi': "Appareil MIDI externe",
        'accuracy_chart_title': 'Précision au fil des exercices',
        'time_chart_title': 'Temps par exercice',
        'accuracy_y_label': 'Précision %',
        'time_y_label': 'Secondes',

      },
      'de': {
        'welcome-title': 'Willkommen bei Muziko',
        'tagline': 'Üben. Spielen. Fortschreiten.',
        'description-1': 'Muziko ist einer der besten Wege, um Ihre Vom-Blatt-Spiel-Fähigkeiten zu schärfen und als Musiker zu wachsen.',
        'description-2': 'Es verbindet sich nahtlos mit jedem MIDI-fähigen digitalen Instrument - wie einem Klavier oder einer MIDI-Gitarre - und erzeugt echte Musiknoten in Echtzeit.',
        'description-3': 'Spielen Sie einfach die Noten, die Sie sehen, und Muziko wird Ihnen sofortiges Feedback zu Ihrer Genauigkeit geben und Ihnen helfen, Note für Note besser zu werden.',
        'start-btn': 'Training Starten',
        'terms': 'Nutzungsbedingungen',
        'privacy': 'Datenschutzrichtlinie',
        'legal': 'Rechtliches',
        'start_button': "Übung starten",
        'status_message': 'Klicke auf "Übung starten", um zu beginnen',
        'accuracy_label': "Genauigkeit:",
        'time_label': "Zeit:",
        'midi_connected': "MIDI-Gerät verbunden!",
        'no_midi_found': "Kein MIDI-Gerät gefunden. Virtuelles Klavier wird verwendet.",
        'midi_failed': "MIDI-Zugriff fehlgeschlagen. Virtuelles Klavier wird verwendet.",
        'device_virtual': "Virtuelles Klavier",
        'device_midi': "Externes MIDI-Gerät",
        'accuracy_chart_title': 'Genauigkeit über Übungen',
        'time_chart_title': 'Zeit pro Übung',
        'accuracy_y_label': 'Genauigkeit %',
        'time_y_label': 'Sekunden',

      },
        'it': {
        'welcome-title': 'Benvenuto su Muziko',
        'tagline': 'Esercitati. Suona. Progredisci.',
        'description-1': 'Muziko è uno dei modi migliori per migliorare le tue abilità di lettura a prima vista e crescere come musicista.',
        'description-2': 'Si collega perfettamente a qualsiasi strumento digitale abilitato per MIDI, come un pianoforte o una chitarra MIDI, e genera spartiti musicali reali in tempo reale.',
        'description-3': 'Suona semplicemente le note che vedi e Muziko ti fornirà un feedback immediato sulla tua precisione, aiutandoti a migliorare nota dopo nota.',
        'start-btn': 'Inizia l\'allenamento',
        'terms': 'Termini di Servizio',
        'privacy': 'Politica sulla Privacy',
        'legal': 'Legale',
        'start_button': "Inizia esercizio",
        'status_message': 'Clicca su "Inizia esercizio" per cominciare',
        'accuracy_label': "Precisione:",
        'time_label': "Tempo:",
        'midi_connected': "Dispositivo MIDI connesso!",
        'no_midi_found': "Nessun dispositivo MIDI trovato. Uso del pianoforte virtuale.",
        'midi_failed': "Accesso MIDI fallito. Uso del pianoforte virtuale.",
        'device_virtual': "Pianoforte virtuale",
        'device_midi': "Dispositivo MIDI esterno",
        'accuracy_chart_title': 'Precisione negli esercizi',
        'time_chart_title': 'Tempo per esercizio',
        'accuracy_y_label': 'Precisione %',
        'time_y_label': 'Secondi',

      },
      'pt': {
        'welcome-title': 'Bem-vindo ao Muziko',
        'tagline': 'Pratique. Toque. Progrida.',
        'description-1': 'Muziko é uma das melhores maneiras de aprimorar suas habilidades de leitura à primeira vista e crescer como músico.',
        'description-2': 'Ele se conecta perfeitamente a qualquer instrumento digital compatível com MIDI - como um piano ou guitarra MIDI - e gera partituras musicais reais em tempo real.',
        'description-3': 'Basta tocar as notas que você vê e o Muziko fornecerá feedback instantâneo sobre sua precisão, ajudando você a melhorar nota por nota.',
        'start-btn': 'Iniciar Treinamento',
        'terms': 'Termos de Serviço',
        'privacy': 'Política de Privacidade',
        'legal': 'Legal',
        'start_button': "Iniciar exercício",
        'status_message': 'Clique em "Iniciar exercício" para começar',
        'accuracy_label': "Precisão:",
        'time_label': "Tempo:",
        'midi_connected': "Dispositivo MIDI conectado!",
        'no_midi_found': "Nenhum dispositivo MIDI encontrado. Usando piano virtual.",
        'midi_failed': "Falha no acesso MIDI. Usando piano virtual.",
        'device_virtual': "Piano virtual",
        'device_midi': "Dispositivo MIDI externo",
        'accuracy_chart_title': 'Precisão ao longo dos exercícios',
        'time_chart_title': 'Tempo por exercício',
        'accuracy_y_label': 'Precisão %',
        'time_y_label': 'Segundos',

      },
        'pl': {
        'welcome-title': 'Witamy w Muziko',
        'tagline': 'Ćwicz. Graj. Postępuj.',
        'description-1': 'Muziko to jeden z najlepszych sposobów na poprawę umiejętności czytania nut a vista i rozwój jako muzyk.',
        'description-2': 'Łączy się bezproblemowo z każdym cyfrowym instrumentem MIDI, takim jak pianino lub gitara MIDI, i generuje prawdziwe nuty w czasie rzeczywistym.',
        'description-3': 'Wystarczy, że zagrasz nuty, które widzisz, a Muziko natychmiast oceni Twoją dokładność, pomagając Ci poprawiać się nuta po nucie.',
        'start-btn': 'Rozpocznij trening',
        'terms': 'Regulamin',
        'privacy': 'Polityka prywatności',
        'legal': 'Informacje prawne',
        'start_button': "Rozpocznij ćwiczenie",
        'status_message': 'Kliknij "Rozpocznij ćwiczenie", aby rozpocząć',
        'accuracy_label': "Dokładność:",
        'time_label': "Czas:",
        'midi_connected': "Urządzenie MIDI podłączone!",
        'no_midi_found': "Nie znaleziono urządzenia MIDI. Używany jest wirtualny fortepian.",
        'midi_failed': "Błąd dostępu do MIDI. Używany jest wirtualny fortepian.",
        'device_virtual': "Wirtualny fortepian",
        'device_midi': "Zewnętrzne urządzenie MIDI",
        'accuracy_chart_title': 'Acuratețe pe parcursul exercițiilor',
        'time_chart_title': 'Timp per exercițiu',
        'accuracy_y_label': 'Acuratețe %',
        'time_y_label': 'Secunde',
        'accuracy_chart_title': 'Dokładność podczas ćwiczeń',
        'time_chart_title': 'Czas na ćwiczenie',
        'accuracy_y_label': 'Dokładność %',
        'time_y_label': 'Sekundy',

      },
      'ro': {
        'welcome-title': 'Bun venit la Muziko',
        'tagline': 'Exersează. Cântă. Progresează.',
        'description-1': 'Muziko este una dintre cele mai bune metode de a-ți îmbunătăți abilitățile de citire la prima vedere și de a te dezvolta ca muzician.',
        'description-2': 'Se conectează perfect la orice instrument digital compatibil MIDI – cum ar fi un pian sau o chitară MIDI – și generează partituri reale în timp real.',
        'description-3': 'Cântă notele pe care le vezi, iar Muziko îți va oferi feedback instantaneu despre acuratețea ta, ajutându-te să progresezi notă cu notă.',
        'start-btn': 'Începe antrenamentul',
        'terms': 'Termeni și condiții',
        'privacy': 'Politica de confidențialitate',
        'legal': 'Legal',
        'start_button': "Începe exercițiul",
        'status_message': 'Apasă "Începe exercițiul" pentru a începe',
        'accuracy_label': "Acuratețe:",
        'time_label': "Timp:",
        'midi_connected': "Dispozitiv MIDI conectat!",
        'no_midi_found': "Niciun dispozitiv MIDI găsit. Se folosește pianul virtual.",
        'midi_failed': "Accesul MIDI a eșuat. Se folosește pianul virtual.",
        'device_virtual': "Pian virtual",
        'device_midi': "Dispozitiv MIDI extern",
        'accuracy_chart_title': 'Acuratețe pe parcursul exercițiilor',
        'time_chart_title': 'Timp per exercițiu',
        'accuracy_y_label': 'Acuratețe %',
        'time_y_label': 'Secunde',

      },
      'hu': {
        'welcome-title': 'Üdvözlünk a Muzikóban',
        'tagline': 'Gyakorolj. Játssz. Fejlődj.',
        'description-1': 'A Muziko az egyik legjobb módja annak, hogy fejleszd a kottaolvasási képességeidet és zenészként fejlődj.',
        'description-2': 'Zökkenőmentesen csatlakozik bármilyen MIDI-kompatibilis digitális hangszerhez, például MIDI-zongorához vagy -gitárhoz, és valós időben generál valódi kottát.',
        'description-3': 'Egyszerűen játszd le a látott hangokat, és a Muziko azonnali visszajelzést ad a pontosságodról, segítve a fejlődésed hangról hangra.',
        'start-btn': 'Edzés indítása',
        'terms': 'Felhasználási feltételek',
        'privacy': 'Adatvédelmi irányelvek',
        'legal': 'Jogi információk',
        'start_button': "Gyakorlat indítása",
        'status_message': 'Kattints a "Gyakorlat indítása" gombra a kezdéshez',
        'accuracy_label': "Pontosság:",
        'time_label': "Idő:",
        'midi_connected': "MIDI-eszköz csatlakoztatva!",
        'no_midi_found': "Nem található MIDI-eszköz. Virtuális zongora használata.",
        'midi_failed': "A MIDI-hozzáférés meghiúsult. Virtuális zongora használata.",
        'device_virtual': "Virtuális zongora",
        'device_midi': "Külső MIDI-eszköz",
        'accuracy_chart_title': 'Pontosság a gyakorlatok során',
        'time_chart_title': 'Idő gyakorlatonként',
        'accuracy_y_label': 'Pontosság %',
        'time_y_label': 'Másodperc',

      },
      'ru': {
        'welcome-title': 'Добро пожаловать в Muziko',
        'tagline': 'Тренируйся. Играй. Развивайся.',
        'description-1': 'Muziko — один из лучших способов улучшить навыки чтения с листа и развиваться как музыкант.',
        'description-2': 'Он беспрепятственно подключается к любому цифровому инструменту с поддержкой MIDI, например, к MIDI-фортепиано или гитаре, и в реальном времени генерирует настоящие ноты.',
        'description-3': 'Просто играйте ноты, которые вы видите, и Muziko сразу оценит точность, помогая вам совершенствоваться шаг за шагом.',
        'start-btn': 'Начать тренировку',
        'terms': 'Условия использования',
        'privacy': 'Политика конфиденциальности',
        'legal': 'Правовая информация',
        'start_button': "Начать упражнение",
        'status_message': 'Нажмите "Начать упражнение", чтобы начать',
        'accuracy_label': "Точность:",
        'time_label': "Время:",
        'midi_connected': "MIDI-устройство подключено!",
        'no_midi_found': "MIDI-устройство не найдено. Используется виртуальное пианино.",
        'midi_failed': "Ошибка доступа к MIDI. Используется виртуальное пианино.",
        'device_virtual': "Виртуальное пианино",
        'device_midi': "Внешнее MIDI-устройство",
        'accuracy_chart_title': 'Точность за упражнения',
        'time_chart_title': 'Время за упражнение',
        'accuracy_y_label': 'Точность %',
        'time_y_label': 'Секунды',

        }
    };

// Language selector functionality
const languageDropdown = document.getElementById('languageDropdown');
const languageBtn = document.getElementById('languageBtn');
const languageOptions = document.getElementById('languageOptions');
const translateLoading = document.getElementById('translateLoading');

let currentLanguage = localStorage.getItem('selectedLanguage') || 'en'; // Get saved language or default to 'en'

// Apply saved language on load
document.addEventListener('DOMContentLoaded', () => {
  const selectedOption = languageOptions.querySelector(`[data-lang="${currentLanguage}"]`);
  if (selectedOption) {
    selectedOption.classList.add('selected');
    languageBtn.querySelector('.language-text').textContent = selectedOption.dataset.code;
  }

  translatePage(currentLanguage);
});

// Toggle dropdown
languageBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  languageDropdown.classList.toggle('open');
});

// Close dropdown when clicking outside
document.addEventListener('click', (e) => {
  if (!languageDropdown.contains(e.target)) {
    languageDropdown.classList.remove('open');
  }
});

// Handle language selection
languageOptions.addEventListener('click', (e) => {
  const option = e.target.closest('.language-option');
  if (!option) return;

  const lang = option.dataset.lang;
  const langCode = option.dataset.code;

  if (lang === currentLanguage) {
    languageDropdown.classList.remove('open');
    return;
  }

  // Update selected language
  const previous = languageOptions.querySelector('.language-option.selected');
  if (previous) previous.classList.remove('selected');
  option.classList.add('selected');

  // Update button display
  languageBtn.querySelector('.language-text').textContent = langCode;

  // Save language to localStorage
  localStorage.setItem('selectedLanguage', lang);

  // Close dropdown
  languageDropdown.classList.remove('open');

  // Translate page
  translatePage(lang);
});

// Translation function
function translatePage(targetLang) {
  if (!translations[targetLang]) {
    console.warn(`Translation for ${targetLang} not available`);
    return;
  }

  translateLoading.style.display = 'block';

  setTimeout(() => {
    const elementsToTranslate = document.querySelectorAll('[data-translate]');
    elementsToTranslate.forEach(element => {
      const key = element.dataset.translate;
      if (translations[targetLang][key]) {
        if (element.tagName === 'A') {
          element.textContent = translations[targetLang][key];
        } else {
          element.innerHTML = element.innerHTML.replace(
            element.textContent.trim(),
            translations[targetLang][key]
          );
        }
      }
    });

    currentLanguage = targetLang;

    // Call the global drawCharts function to update charts with new language
    if (typeof window.drawCharts === 'function') {
      window.drawCharts();
    }

    translateLoading.style.display = 'none';
  }, 500);
}

// Keyboard navigation
languageOptions.addEventListener('keydown', (e) => {
  const options = Array.from(languageOptions.querySelectorAll('.language-option'));
  const currentIndex = options.findIndex(opt => opt === document.activeElement);

  switch(e.key) {
    case 'ArrowDown':
      e.preventDefault();
      const nextIndex = (currentIndex + 1) % options.length;
      options[nextIndex].focus();
      break;
    case 'ArrowUp':
      e.preventDefault();
      const prevIndex = (currentIndex - 1 + options.length) % options.length;
      options[prevIndex].focus();
      break;
    case 'Enter':
    case ' ':
      e.preventDefault();
      document.activeElement.click();
      break;
    case 'Escape':
      languageDropdown.classList.remove('open');
      languageBtn.focus();
      break;
  }
});